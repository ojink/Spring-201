<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="board">

<!-- 검색조건 -->
<sql id="seachWhere">
<choose>
	<when test=" search == 's1' "> <!-- 전체 -->
	where title like '%' || #{keyword} || '%'
	or content  like '%' || #{keyword} || '%'
	or writer in (select user_id from member where name like '%' || #{keyword} || '%')
	</when>
	<when test=" search == 's2' "> <!-- 제목 -->
	where title like '%' || #{keyword} || '%'
	</when>
	<when test=" search == 's5' "> <!-- 제목+내용 -->
	where title like '%' || #{keyword} || '%'
	or content  like '%' || #{keyword} || '%'
	</when>
	<when test=" search == 's3' "> <!-- 내용 -->
	where content like '%' || #{keyword} || '%'
	</when>
	<when test=" search == 's4' "> <!-- 작성자 -->
	where writer in (select user_id from member where name like '%' || #{keyword} || '%')
	</when>
</choose>
</sql>

<!-- 총 글건수 조회 -->
<select id="totalList" resultType="integer">
select count(id) from board <include refid="seachWhere"/>
</select>

<!-- 해당페이지의 10건의 정보목록 조회 -->
<select id="list" resultType="board">
select * 
from (select b.*, name, row_number() over(order by id) no
	  from board b left outer join member m on b.writer = m.user_id  <include refid="seachWhere"/> ) b
where no between #{beginList} and #{endList}
order by no desc
</select>

</mapper>